<div class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
  <!-- Skip to main content for accessibility -->
  <a
    href="#main-content"
    class="sr-only z-50 rounded-lg bg-white px-4 py-2 font-medium text-gray-900 shadow-lg focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:ring-2 focus:ring-blue-500 focus:outline-none"
  >
    Skip to main content
  </a>
  <!-- Header -->
  <header class="relative flex flex-col items-center pt-8 pb-6" role="banner">
    <!-- Navigation Controls - Moved outside relative positioning -->
    <div
      class="absolute top-4 right-0 left-0 z-10 mx-auto flex w-full max-w-screen-xl items-center justify-between px-4"
    >
      <!-- Back Button -->
      <button
        (click)="onBack()"
        class="flex items-center gap-2 rounded-lg border border-slate-300 bg-slate-100 px-4 py-2 text-slate-700 shadow-sm backdrop-blur-sm transition-all duration-300 hover:bg-slate-200 hover:shadow-md focus:ring-2 focus:ring-slate-400 focus:outline-none"
        aria-label="Go back to home page"
        type="button"
      >
        <i class="pi pi-arrow-left" aria-hidden="true"></i>
        <span class="hidden font-medium sm:inline">Back</span>
      </button>

      <!-- Navigation Button Group -->
      <div class="flex items-center gap-3">
        <!-- View Toggle Button -->
        <button
          (click)="toggleViewMode()"
          class="flex items-center gap-2 rounded-lg border border-indigo-300 bg-indigo-600 px-4 py-2 text-white shadow-sm backdrop-blur-sm transition-all duration-300 hover:bg-indigo-700 hover:shadow-md focus:ring-2 focus:ring-indigo-400 focus:outline-none"
          [attr.aria-label]="isFullWidth() ? 'Switch to compact view' : 'Switch to full width view'"
          type="button"
        >
          <i
            class="pi transition-transform duration-300"
            [class.pi-compress]="isFullWidth()"
            [class.pi-expand]="!isFullWidth()"
            aria-hidden="true"
          ></i>
          <span class="hidden font-medium sm:inline">
            {{ isFullWidth() ? 'Compact' : 'Full Width' }}
          </span>
        </button>
        <!-- Sign Out Button -->
        <button
          (click)="onSignOut()"
          class="flex items-center gap-2 rounded-lg border border-red-600 bg-red-600 px-4 py-2 text-white shadow-sm backdrop-blur-sm transition-all duration-300 hover:bg-red-700 hover:shadow-md focus:ring-2 focus:ring-red-400 focus:outline-none"
          aria-label="Sign out of the application"
          type="button"
        >
          <i class="pi pi-sign-out" aria-hidden="true"></i>
          <span class="hidden font-medium sm:inline">Sign Out</span>
        </button>
      </div>
    </div>

    <!-- Logo and Title -->
    <div class="mb-4" aria-label="NXAcademy logo">
      <svg
        width="48"
        height="48"
        viewBox="0 0 64 64"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        role="img"
        aria-labelledby="logo-title"
      >
        <title id="logo-title">NXAcademy Logo</title>
        <circle
          cx="32"
          cy="32"
          r="30"
          fill="url(#grad1)"
          stroke="#fff"
          stroke-width="2"
        />
        <defs>
          <radialGradient id="grad1" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#a4508b" />
            <stop offset="100%" stop-color="#3a1c71" />
          </radialGradient>
        </defs>
        <rect
          x="26"
          y="40"
          width="12"
          height="6"
          rx="2"
          fill="#fff"
          fill-opacity="0.8"
        />
        <ellipse
          cx="32"
          cy="32"
          rx="10"
          ry="12"
          fill="#fff"
          fill-opacity="0.9"
        />
        <path
          d="M22 32 Q14 28 22 24"
          stroke="#fff"
          stroke-width="2"
          fill="none"
        />
        <path
          d="M42 32 Q50 28 42 24"
          stroke="#fff"
          stroke-width="2"
          fill="none"
        />
        <polygon
          points="32,26 33.8,30.2 38.4,30.6 34.8,33.4 36,38 32,35.2 28,38 29.2,33.4 25.6,30.6 30.2,30.2"
          fill="#a4508b"
        />
      </svg>
    </div>
    <h1
      class="mb-2 text-3xl font-extrabold text-gray-800 drop-shadow-lg md:text-4xl"
    >
      NXAcademy
    </h1>
    <p class="text-lg font-semibold text-gray-700 drop-shadow">
      Choose Your Branch
    </p>
  </header>
  <!-- Branch Cards Grid -->
  <main
    id="main-content"
    class="flex-1 px-4 pb-8 transition-all duration-700 ease-in-out"
    role="main"
    [attr.aria-busy]="isLoading()"
  >
    <!-- Loading State -->
    @if (isLoading()) {
    <div
      class="flex items-center justify-center py-12"
      role="status"
      aria-live="polite"
    >
      <div class="text-center text-gray-800">
        <i
          class="pi pi-spinner mb-4 animate-spin text-4xl text-gray-700"
          aria-hidden="true"
        ></i>
        <p class="text-lg font-medium text-gray-700">Loading branches...</p>
      </div>
    </div>
    }

    <!-- Error State -->
    @else if (hasError()) {
    <div
      class="flex items-center justify-center py-12"
      role="alert"
      aria-live="assertive"
    >
      <div class="max-w-md text-center text-gray-800">
        <i
          class="pi pi-exclamation-triangle mb-4 text-4xl text-red-600"
          aria-hidden="true"
        ></i>
        <h2 class="mb-2 text-xl font-semibold text-gray-800">
          Unable to Load Branches
        </h2>
        <p class="mb-4 text-gray-700">
          There was an error loading the branch information. Please try again.
        </p>
        <button
          (click)="loadBranches()"
          class="rounded-lg bg-red-600 px-6 py-2 text-white transition-colors duration-200 hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:outline-none"
          type="button"
        >
          Retry
        </button>
      </div>
    </div>
    }

    <!-- Branch Grid -->
    @else {
    <div
      class="mx-auto transition-all duration-700 ease-in-out"
      [class.max-w-7xl]="!isFullWidth()"
    >
      <div
        class="grid gap-6 transition-all duration-700 ease-in-out"
        [class]="isFullWidth() ? 
            'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6' : 
            'grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4'"
      >
        @for (branch of sortedBranches(); track branch.id; let i = $index) {
        <article
          (click)="onBranchClick(branch)"
          (keydown.enter)="onBranchClick(branch)"
          (keydown.space)="$event.preventDefault(); onBranchClick(branch)"
          class="branch-card group cursor-pointer overflow-hidden rounded-lg transition-all duration-300 ease-in-out hover:-translate-y-1 hover:shadow-xl focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:outline-none"
          [class]="getCategoryCardClass(branch.category)"
          [attr.data-index]="i"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Select ' + branch.name + ' branch in ' + branch.location + ', ' + branch.category + ' category, ' + branch.activePlayers + ' active players, ' + branch.teams + ' teams'"
        >
          <!-- Branch Header with Category Icon -->
          <div
            class="relative flex h-32 items-center justify-center overflow-hidden rounded-t-lg"
            [class]="getCategoryHeaderClass(branch.category)"
          >
            <!-- Category Icon -->
            <div class="relative z-10 flex items-center justify-center">
              <div
                class="flex h-24 w-24 items-center justify-center rounded-full border border-gray-200 bg-white shadow-md transition-all duration-300 group-hover:scale-105 group-hover:shadow-lg"
              >
                <i
                  class="category-icon-medium transition-all duration-300"
                  [class]="'pi ' + getCategoryIcon(branch.category) + ' ' + getCategoryColor(branch.category)"
                  [attr.aria-label]="branch.category + ' category icon'"
                ></i>
              </div>
            </div>
            <!-- Category Badge -->
            <div
              class="absolute top-3 right-3 z-20 rounded-md px-2.5 py-1 text-xs transition-all duration-300"
              [class]="getCategoryStyles(branch.category)"
              [attr.aria-label]="branch.category + ' category badge'"
            >
              <i
                class="pi mr-1"
                [class]="getCategoryIcon(branch.category)"
                aria-hidden="true"
              ></i>
              {{ branch.category }}
            </div>
          </div>
          <!-- Branch Info -->
          <div
            class="branch-card-content relative rounded-b-lg p-5"
            [class]="getCategoryContentClass(branch.category)"
          >
            <!-- Branch Name -->
            <h3
              class="mb-2 text-center text-lg font-semibold text-gray-800 transition-colors duration-300 group-hover:text-gray-900"
            >
              {{ branch.name }}
            </h3>

            <!-- Location -->
            <div class="mb-4 flex items-center justify-center text-gray-600">
              <i
                class="pi pi-map-marker mr-2 text-sm text-gray-500"
                aria-hidden="true"
              ></i>
              <span class="text-sm font-medium">{{ branch.location }}</span>
            </div>

            <!-- Additional Info -->
            <div
              class="flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-600"
            >
              <span
                class="flex items-center"
                [attr.aria-label]="branch.teams + ' teams'"
              >
                <i
                  class="pi pi-users mr-1 text-gray-500"
                  aria-hidden="true"
                ></i>
                <span class="font-medium">{{ branch.teams }} Teams</span>
              </span>
              <span
                class="flex items-center"
                [attr.aria-label]="branch.activePlayers + ' active players'"
              >
                <span class="font-medium text-gray-600">Active:</span>
                <span class="ml-1 font-semibold text-gray-800"
                  >{{ branch.activePlayers }}</span
                >
              </span>
            </div>
          </div>
        </article>
        }
      </div>
    </div>
    }
  </main>

  <!-- Toast Container for Notifications -->
  <p-toast
    position="top-right"
    [life]="5000"
    [showTransformOptions]="'translateX(100%)'"
    [hideTransformOptions]="'translateX(100%)'"
    [showTransitionOptions]="'300ms ease-out'"
    [hideTransitionOptions]="'250ms ease-in'"
  ></p-toast>
</div>
