<!-- Top Bar Container -->
<header
  class="topbar-container"
  [class.sidebar-minimized]="isSidebarMinimized()"
>
  <!-- Left Section: Menu Toggles -->
  <div class="topbar-left">
    <!-- Desktop Sidebar Toggle -->
    <button
      class="desktop-sidebar-toggle"
      (click)="toggleDesktopSidebar()"
      aria-label="Toggle sidebar"
      type="button"
    >
      <i class="pi pi-bars"></i>
    </button>

    <!-- Mobile Menu Toggle -->
    <button
      class="mobile-menu-btn"
      (click)="toggleMobileMenu()"
      aria-label="Toggle mobile menu"
      type="button"
    >
      <i class="pi pi-bars"></i>
    </button>
  </div>

  <!-- Right Section: User Profile & Notifications -->
  <div class="topbar-right">
    <!-- Notifications -->
    <div class="notification-container">
      <button
        class="notification-btn"
        id="notifications-button"
        (click)="toggleNotifications()"
        [attr.aria-expanded]="isNotificationsOpen()"
        aria-label="Notifications"
        type="button"
      >
        <i class="pi pi-bell"></i>
        <span
          class="notification-badge"
          *ngIf="getUnreadCount() > 0"
          [attr.aria-label]="getUnreadCount() + ' unread notifications'"
        >
          {{ getUnreadCount() }}
        </span>
      </button>
      <!-- Notifications Dropdown -->
      <div
        class="notification-dropdown"
        [class.open]="isNotificationsOpen()"
        tabindex="-1"
        role="menu"
        aria-labelledby="notifications-button"
      >
        <div class="dropdown-header">
          <h3>Notifications</h3>
          <span class="notification-count">{{ getUnreadCount() }} new</span>
        </div>

        <div class="notification-list">
          <div
            *ngFor="let notification of notifications()"
            class="notification-item"
            [class.unread]="!notification.isRead"
          >
            <div
              class="notification-icon"
              [class]="'notification-' + notification.type"
            >
              <i
                class="pi"
                [ngClass]="{
                  'pi-info-circle': notification.type === 'info',
                  'pi-check-circle': notification.type === 'success',
                  'pi-exclamation-triangle': notification.type === 'warning'
                }"
              >
              </i>
            </div>
            <div class="notification-content">
              <div class="notification-title">{{ notification.title }}</div>
              <div class="notification-message">{{ notification.message }}</div>
              <div class="notification-time">
                {{ notification.timestamp | date:'short' }}
              </div>
            </div>
            <button
              *ngIf="!notification.isRead"
              class="mark-read-btn"
              (click)="markAsRead(notification.id, $event)"
              aria-label="Mark as read"
              type="button"
            >
              <i class="pi pi-check"></i>
            </button>
          </div>
        </div>

        <div class="dropdown-footer">
          <button class="view-all-btn" type="button">
            View All Notifications
          </button>
        </div>
      </div>
    </div>

    <!-- User Profile -->
    <div class="user-profile-container">
      <button
        class="user-profile-btn"
        id="user-profile-button"
        (click)="toggleUserMenu()"
        [attr.aria-expanded]="isUserMenuOpen()"
        aria-label="User menu"
        type="button"
      >
        <div class="user-avatar">
          <span class="avatar-text">{{ getUserInitials() }}</span>
        </div>
        <div class="user-info">
          <div class="user-name">{{ currentUser().name }}</div>
          <div class="user-email">{{ currentUser().email }}</div>
        </div>
        <i
          class="pi pi-chevron-down dropdown-arrow"
          [class.rotated]="isUserMenuOpen()"
        >
        </i>
      </button>
      <!-- User Menu Dropdown -->
      <div
        class="user-menu-dropdown"
        [class.open]="isUserMenuOpen()"
        tabindex="-1"
        role="menu"
        aria-labelledby="user-profile-button"
      >
        <!-- User Info Header -->
        <div class="dropdown-user-info">
          <div class="user-avatar-large">
            <span class="avatar-text">{{ getUserInitials() }}</span>
          </div>
          <div class="user-details-full">
            <div class="user-name-large">{{ currentUser().name }}</div>
            <div class="user-role-badge">{{ currentUser().role }}</div>
            <div class="user-email-small">{{ currentUser().email }}</div>
          </div>
        </div>

        <div class="menu-separator"></div>

        <!-- Menu Items -->
        <div class="dropdown-menu-items">
          <button
            class="dropdown-menu-item"
            (click)="navigateToProfile()"
            type="button"
          >
            <div class="menu-item-icon">
              <i class="pi pi-user"></i>
            </div>
            <span class="menu-item-text">My Profile</span>
            <i class="pi pi-chevron-right menu-item-arrow"></i>
          </button>

          <button
            class="dropdown-menu-item"
            (click)="navigateToSettings()"
            type="button"
          >
            <div class="menu-item-icon">
              <i class="pi pi-cog"></i>
            </div>
            <span class="menu-item-text">Account Settings</span>
            <i class="pi pi-chevron-right menu-item-arrow"></i>
          </button>

          <button class="dropdown-menu-item" type="button">
            <div class="menu-item-icon">
              <i class="pi pi-bell"></i>
            </div>
            <span class="menu-item-text">Notifications</span>
            <i class="pi pi-chevron-right menu-item-arrow"></i>
          </button>

          <button class="dropdown-menu-item" type="button">
            <div class="menu-item-icon">
              <i class="pi pi-question-circle"></i>
            </div>
            <span class="menu-item-text">Help & Support</span>
            <i class="pi pi-chevron-right menu-item-arrow"></i>
          </button>
        </div>

        <div class="menu-separator"></div>

        <!-- Sign Out -->
        <div class="dropdown-footer">
          <button class="sign-out-btn" (click)="logout()" type="button">
            <div class="menu-item-icon sign-out-icon">
              <i class="pi pi-sign-out"></i>
            </div>
            <span class="menu-item-text">Sign Out</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Backdrop for dropdowns -->
<div
  class="topbar-backdrop"
  [class.visible]="isUserMenuOpen() || isNotificationsOpen()"
  (click)="closeDropdowns()"
  (keydown.escape)="closeDropdowns()"
  tabindex="-1"
  role="presentation"
  aria-hidden="true"
></div>
