<!-- Sidebar Container -->
<aside
  class="sidebar-container"
  [class.mobile-open]="isMobileMenuOpen()"
  [class.minimized]="isMinimizedState()"
>
  <!-- Header Section -->
  <div class="sidebar-header">
    <div class="brand-section">
      <div class="brand-logo">
        <svg
          width="32"
          height="32"
          viewBox="0 0 64 64"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <!-- Background Circle with Gradient -->
          <defs>
            <linearGradient
              id="logoGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="100%"
            >
              <stop offset="0%" style="stop-color: #7c3aed" />
              <stop offset="100%" style="stop-color: #5b21b6" />
            </linearGradient>
            <filter
              id="logoShadow"
              x="-50%"
              y="-50%"
              width="200%"
              height="200%"
            >
              <feDropShadow
                dx="0"
                dy="2"
                stdDeviation="2"
                flood-opacity="0.3"
              />
            </filter>
          </defs>

          <circle
            cx="32"
            cy="32"
            r="30"
            fill="url(#logoGradient)"
            filter="url(#logoShadow)"
            stroke="#ffffff"
            stroke-width="2"
          />

          <!-- Trophy Base -->
          <rect x="25" y="44" width="14" height="5" rx="2.5" fill="#ffffff" />

          <!-- Trophy Stem -->
          <rect x="29" y="39" width="6" height="5" rx="1" fill="#ffffff" />

          <!-- Trophy Bowl/Cup -->
          <path
            d="M20 25 Q20 18, 32 18 Q44 18, 44 25 L43 34 Q43 39, 32 39 Q21 39, 21 34 Z"
            fill="#ffffff"
          />

          <!-- Trophy Handles -->
          <path
            d="M18 27 Q15 27, 14 30 Q15 33, 18 33"
            stroke="#ffffff"
            stroke-width="2.5"
            fill="none"
            stroke-linecap="round"
          />
          <path
            d="M46 27 Q49 27, 50 30 Q49 33, 46 33"
            stroke="#ffffff"
            stroke-width="2.5"
            fill="none"
            stroke-linecap="round"
          />

          <!-- Trophy Details/Decoration -->
          <ellipse cx="32" cy="26" rx="8" ry="2" fill="#7C3AED" opacity="0.7" />

          <!-- Star/Award Symbol -->
          <path
            d="M32 20 L33.5 23.5 L37 23.5 L34.25 25.75 L35.75 29.25 L32 27 L28.25 29.25 L29.75 25.75 L27 23.5 L30.5 23.5 Z"
            fill="#FFD700"
          />
        </svg>
      </div>
      <div class="brand-text" *ngIf="!isMinimizedState()">
        <h2 class="brand-title">AthletaNX Academy</h2>
        <p class="brand-subtitle">
          {{ selectedBranch()?.name || 'Select Branch' }}
        </p>
      </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button
      class="mobile-menu-toggle"
      (click)="toggleMobileMenu()"
      [attr.aria-expanded]="isMobileMenuOpen()"
      aria-label="Toggle mobile menu"
    >
      <span class="hamburger-line" [class.active]="isMobileMenuOpen()"></span>
      <span class="hamburger-line" [class.active]="isMobileMenuOpen()"></span>
      <span class="hamburger-line" [class.active]="isMobileMenuOpen()"></span>
    </button>
  </div>

  <!-- Navigation Menu -->
  <nav class="sidebar-nav">
    <ul class="nav-list">
      <li *ngFor="let item of menuItems" class="nav-item">
        <!-- Main Menu Item -->
        <button
          class="nav-link"
          [class.active]="item.isActive"
          [class.expanded]="item.isExpanded && !isMinimizedState()"
          [class.minimized-item]="isMinimizedState()"
          (click)="toggleMenuItem(item, $event)"
          (mouseenter)="showHoverPopup(item, $event)"
          (mouseleave)="hideHoverPopup()"
          [attr.aria-expanded]="item.children && !isMinimizedState() ? item.isExpanded : null"
          [attr.aria-label]="item.label"
        >
          <div class="nav-link-content">
            <i class="nav-icon pi" [ngClass]="item.icon"></i>
            <span class="nav-label" *ngIf="!isMinimizedState()"
              >{{ item.label }}</span
            >
          </div>
          <i
            *ngIf="item.children && !isMinimizedState()"
            class="expand-icon pi pi-chevron-down"
            [class.rotated]="item.isExpanded"
          ></i>
        </button>

        <!-- Submenu -->
        <div
          *ngIf="item.children && !isMinimizedState()"
          class="submenu-container"
          [class.expanded]="item.isExpanded"
        >
          <ul class="submenu-list">
            <li *ngFor="let subItem of item.children" class="submenu-item">
              <!-- Sub Menu Item -->
              <button
                class="submenu-link"
                [class.active]="subItem.isActive"
                [class.expanded]="subItem.isExpanded"
                (click)="toggleSubMenuItem(item, subItem, $event)"
                [attr.aria-expanded]="
                  subItem.children ? subItem.isExpanded : null
                "
                [attr.aria-label]="subItem.label"
              >
                <div class="submenu-link-content">
                  <i class="submenu-icon pi" [ngClass]="subItem.icon"></i>
                  <span class="submenu-label">{{ subItem.label }}</span>
                </div>
                <i
                  *ngIf="subItem.children"
                  class="expand-icon pi pi-chevron-down"
                  [class.rotated]="subItem.isExpanded"
                ></i>
              </button>

              <!-- Nested Submenu (Settings) -->
              <div
                *ngIf="subItem.children"
                class="nested-submenu-container"
                [class.expanded]="subItem.isExpanded"
              >
                <ul class="nested-submenu-list">
                  <li
                    *ngFor="let nestedItem of subItem.children"
                    class="nested-submenu-item"
                  >
                    <button
                      class="nested-submenu-link"
                      [class.active]="nestedItem.isActive"
                      (click)="navigateToRoute(nestedItem)"
                      [attr.aria-label]="nestedItem.label"
                    >
                      <i
                        class="nested-submenu-icon pi"
                        [ngClass]="nestedItem.icon"
                      ></i>
                      <span class="nested-submenu-label"
                        >{{ nestedItem.label }}</span
                      >
                    </button>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Bottom Section -->
  <div class="sidebar-bottom" *ngIf="!isMinimizedState()">
    <!-- Branch Selector with ng-select -->
    <div class="dropdown-section">
      <div class="dropdown-label-text">Branch</div>
      <ng-select
        [items]="branches"
        bindLabel="name"
        bindValue="id"
        [(ngModel)]="selectedBranch"
        (change)="onBranchChange($event)"
        [clearable]="false"
        [searchable]="true"
        placeholder="Select Branch"
        class="ng-select-custom branch-select"
        aria-label="Select Branch"
      >
      </ng-select>
    </div>

    <!-- Sport Selector with ng-select -->
    <div class="dropdown-section">
      <div class="dropdown-label-text">Sport Type</div>
      <ng-select
        [items]="sportTypes"
        bindLabel="name"
        bindValue="id"
        [(ngModel)]="selectedSport"
        (change)="onSportChange($event)"
        [clearable]="false"
        [searchable]="true"
        placeholder="Select Sport"
        class="ng-select-custom sport-select"
        aria-label="Select Sport Type"
      >
      </ng-select>
    </div>
  </div>
</aside>

<!-- Hover Popup for Minimized Sidebar -->
<div
  *ngIf="isMinimizedState() && hoveredItem()"
  class="minimized-hover-popup"
  (mouseenter)="keepPopupVisible()"
  (mouseleave)="hidePopupImmediately()"
>
  <div class="popup-content">
    <div class="popup-header">
      <i class="popup-icon pi" [ngClass]="hoveredItem()?.icon"></i>
      <span class="popup-title">{{ hoveredItem()?.label }}</span>
    </div>

    <!-- Show children if available -->
    <div
      *ngIf="hoveredItem()?.children && hoveredItem()!.children!.length > 0"
      class="popup-submenu"
    >
      <ul class="popup-submenu-list">
        <li
          *ngFor="let subItem of hoveredItem()?.children"
          class="popup-submenu-item"
        >
          <button
            class="popup-submenu-link"
            [class.active]="subItem.isActive"
            (click)="navigateToRoute(subItem); hidePopupImmediately()"
          >
            <i class="popup-submenu-icon pi" [ngClass]="subItem.icon"></i>
            <span class="popup-submenu-label">{{ subItem.label }}</span>
          </button>
        </li>
      </ul>
    </div>

    <!-- Show direct navigation if no children -->
    <div
      *ngIf="!hoveredItem()?.children || hoveredItem()!.children!.length === 0"
      class="popup-direct-nav"
    >
      <button
        class="popup-nav-button"
        (click)="navigateToRoute(hoveredItem()!); hidePopupImmediately()"
      >
        Click to navigate
      </button>
    </div>
  </div>
</div>

<!-- Backdrop for mobile -->
<div
  class="sidebar-backdrop"
  [class.mobile-visible]="isMobileMenuOpen()"
  (click)="toggleMobileMenu()"
  (keydown.escape)="isMobileMenuOpen() && toggleMobileMenu()"
  tabindex="0"
  role="button"
  aria-label="Close sidebar"
></div>
